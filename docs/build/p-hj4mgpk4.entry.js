import{r as s,f as t,w as i,m as l,c as o,h as e,e as h,H as n}from"./p-212d0ebd.js";class r{constructor(i){s(this,i),this.thrPx=0,this.thrPc=0,this.didFire=!1,this.isBusy=!1,this.isLoading=!1,this.threshold="15%",this.disabled=!1,this.position="bottom",this.onScroll=()=>{const s=this.scrollEl;if(!s||!this.canStart())return 1;const t=this.el.offsetHeight;if(0===t)return 2;const i=s.scrollTop,l=s.offsetHeight,o=0!==this.thrPc?l*this.thrPc:this.thrPx;if(("bottom"===this.position?s.scrollHeight-t-i-o-l:i-t-o)<0){if(!this.didFire)return this.isLoading=!0,this.didFire=!0,this.ionInfinite.emit(),3}else this.didFire=!1;return 4},this.ionInfinite=t(this,"ionInfinite",7)}thresholdChanged(){const s=this.threshold;s.lastIndexOf("%")>-1?(this.thrPx=0,this.thrPc=parseFloat(s)/100):(this.thrPx=parseFloat(s),this.thrPc=0)}disabledChanged(){const s=this.disabled;s&&(this.isLoading=!1,this.isBusy=!1),this.enableScrollEvents(!s)}async componentDidLoad(){const s=this.el.closest("ion-content");s&&(await s.componentOnReady(),this.scrollEl=await s.getScrollElement()),this.thresholdChanged(),this.disabledChanged(),"top"===this.position&&i(()=>{this.scrollEl&&(this.scrollEl.scrollTop=this.scrollEl.scrollHeight-this.scrollEl.clientHeight)})}componentDidUnload(){this.enableScrollEvents(!1),this.scrollEl=void 0}async complete(){const s=this.scrollEl;if(this.isLoading&&s&&(this.isLoading=!1,"top"===this.position)){this.isBusy=!0;const t=s.scrollHeight-s.scrollTop;requestAnimationFrame(()=>{l(()=>{const l=s.scrollHeight-t;requestAnimationFrame(()=>{i(()=>{s.scrollTop=l,this.isBusy=!1})})})})}}canStart(){return!(this.disabled||this.isBusy||!this.scrollEl||this.isLoading)}enableScrollEvents(s){this.scrollEl&&(s?this.scrollEl.addEventListener("scroll",this.onScroll):this.scrollEl.removeEventListener("scroll",this.onScroll))}render(){const s=o(this);return e(n,{class:{[s]:!0,"infinite-scroll-loading":this.isLoading,"infinite-scroll-enabled":!this.disabled}})}get el(){return h(this)}static get watchers(){return{threshold:["thresholdChanged"],disabled:["disabledChanged"]}}static get style(){return"ion-infinite-scroll{display:none;width:100%}.infinite-scroll-enabled{display:block}"}}export{r as ion_infinite_scroll};